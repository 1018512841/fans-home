<div class="container">
  <div class="hero-unit" id="tourist_detail_container">

    <p id="notice">
      <%= notice %>
    </p>

    <div class="row">
      <div class="span3">
        <%= image_tag(@tourist_post.get_image_cover_url,
                      {class: "img-rounded img-polaroid index_image_round",
                       width: "60%"}) %>
      </div>
      <div class="span7">
        <div class="row">
            <span style="font-size: xx-large">
             <%= @tourist_post.city %>
            </span>
        </div>
        <div class="row">
          <%= @tourist_post.description %>
        </div>
        <div class="row">
          <% if current_is_admin? %>
              <%= link_to I18n.t("edit_btn"),
                          edit_tourist_post_path(@tourist_post),
                          {id: "tourist_detail_edit_btn",
                           class: "btn btn-primary"} %>
              <%= link_to I18n.t("delete_btn"),
                          tourist_post_path(@tourist_post),
                          {id: "tourist_detail_delete_btn",
                           method: "delete",
                           data: {confirm: "Are you sure?"},
                           class: "btn btn-primary"} %>
          <% end %>
          <%= link_to I18n.t("back_btn"), tourist_posts_path, {class: "btn btn-primary"} %>
        </div>
      </div>
    </div>
    <div class="row text-center">
      <%= button_tag "管理相册", {id: "tourist_image_manage_btn", class: "btn btn-primary"} do %>
          管理相册
          <i class="icon-chevron-down"> </i>
      <% end %>
    </div>
    <p class="text-center">
      <%= form_tag "/tourist_posts/upload_image", {class: "dropzone", id: "my-awesome-dropzone"} do %>
          <%= hidden_field_tag "tourist_post_id", @tourist_post.id %>
      <% end %>
    </p>

    <p class="lead">
      <% @tourist_post.get_normal_images.each do |image| %>
          <span class="image_wrapper">
            <%= image_tag(image.avatar.url,
                          {class: "img-rounded img-polaroid"}) %>
            <i class="icon-remove image_wrapper_remove" data-image-id="<%= image.id %>"></i>
          </span>
      <% end %>
    </p>

  </div>
</div>

<script>
    $(function () {
        var $dropzone = $("#my-awesome-dropzone");
        if (!$dropzone[0].dropzone) {
            var drop = $dropzone.dropzone({
                        addRemoveLinks: true
                    }
            );
            drop.on("removedfile", function (file) {
                        alert("delete");
                    });
            drop.on("selectedfiles", function(files) {
                drop.removeAllFiles(files);
            });

        }
        $("#tourist_image_manage_btn").click(function () {
            $dropzone.toggle();
            $(this).children("i").toggleClass("icon-chevron-down icon-chevron-up");
            $(".image_wrapper").toggleClass("image_wrapper_manage");
            $(".image_wrapper_remove").toggle();
        });
        $(".image_wrapper_remove").click(function(){
            var $this = $(this);
            var options = {
                url: "/tourist_posts/destroy_image",
                data: {
                    image_id: $(this).data("imageId"),
                    tourist_id: $("#tourist_post_id").val()
                },
                type: "post",
                success: function(){
                    $this.parents(".image_wrapper").remove();
                }
            };
            $.ajax(options);
        });
    })
</script>